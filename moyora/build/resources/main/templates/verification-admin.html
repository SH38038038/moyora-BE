<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹ ë¶„ì¦ ì¸ì¦ ê´€ë¦¬ì í˜ì´ì§€</title>
    <script>
        async function loadVerifications() {
            const response = await fetch('/api/verification/pending');
            const result = await response.json();

            const table = document.getElementById('verification-table');
            table.innerHTML = '';

            result.data.forEach(v => {
                const row = `
                    <tr>
                        <td>${v.email}</td>
                        <td>${v.birth}</td>
                        <td>${v.gender}</td>
                        <td><img src="${v.idcardUrl}" width="100"></td>
                        <td>${v.status}</td>
                        <td>
                            <button onclick="viewDetail(${v.verificationId})">ìƒì„¸</button>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }

        async function viewDetail(id) {
            const response = await fetch(`/api/verification/details/${id}`);
            const result = await response.json();
            const v = result.data;

            document.getElementById('detail').innerHTML = `
                <h3>ìƒì„¸ ë³´ê¸°</h3>
                <p>ì´ë©”ì¼: ${v.email}</p>
                <p>ìƒì¼: ${v.birth}</p>
                <p>ì„±ë³„: ${v.gender}</p>
                <p>ìƒíƒœ: ${v.status}</p>
                <img src="${v.idcardUrl}" width="300"/>
                <br><br>
                <button onclick="accept(${id})">âœ… ìˆ˜ë½</button>
                <button onclick="reject(${id})">âŒ ê±°ì ˆ</button>
                <button onclick="del(${id})">ğŸ—‘ ì‚­ì œ</button>
            `;
        }

        async function accept(id) {
            await fetch(`/api/verification/accept/${id}`, { method: 'PUT' });
            alert('ìˆ˜ë½ ì²˜ë¦¬ë¨');
            loadVerifications();
        }

        async function reject(id) {
            await fetch(`/api/verification/reject/${id}`, { method: 'PUT' });
            alert('ê±°ì ˆ ì²˜ë¦¬ë¨');
            loadVerifications();
        }

        async function del(id) {
            await fetch(`/api/verification/delete/${id}`, { method: 'DELETE' });
            alert('ì‚­ì œ ì™„ë£Œ');
            loadVerifications();
        }

        window.onload = loadVerifications;
    </script>
</head>
<body>
<h1>ì‹ ë¶„ì¦ ì¸ì¦ ìš”ì²­ ëª©ë¡</h1>
<table border="1">
    <thead>
    <tr>
        <th>ì´ë©”ì¼</th>
        <th>ìƒë…„ì›”ì¼</th>
        <th>ì„±ë³„</th>
        <th>ì‚¬ì§„</th>
        <th>ìƒíƒœ</th>
        <th>ê´€ë¦¬</th>
    </tr>
    </thead>
    <tbody id="verification-table"></tbody>
</table>

<hr>

<div id="detail"></div>
</body>
</html>
