<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>신분증 인증 관리자 페이지</title>
    <script>
        async function loadVerifications() {
            const response = await fetch('/api/verification/pending');
            const result = await response.json();

            const table = document.getElementById('verification-table');
            table.innerHTML = '';

            result.data.forEach(v => {
                const row = `
                    <tr>
                        <td>${v.email}</td>
                        <td>${v.birth}</td>
                        <td>${v.gender}</td>
                        <td><img src="${v.idcardUrl}" width="100"></td>
                        <td>${v.status}</td>
                        <td>
                            <button onclick="viewDetail(${v.verificationId})">상세</button>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }

        async function viewDetail(id) {
            const response = await fetch(`/api/verification/details/${id}`);
            const result = await response.json();
            const v = result.data;

            document.getElementById('detail').innerHTML = `
                <h3>상세 보기</h3>
                <p>이메일: ${v.email}</p>
                <p>생일: ${v.birth}</p>
                <p>성별: ${v.gender}</p>
                <p>상태: ${v.status}</p>
                <img src="${v.idcardUrl}" width="300"/>
                <br><br>
                <button onclick="accept(${id})">✅ 수락</button>
                <button onclick="reject(${id})">❌ 거절</button>
                <button onclick="del(${id})">🗑 삭제</button>
            `;
        }

        async function accept(id) {
            await fetch(`/api/verification/accept/${id}`, { method: 'PUT' });
            alert('수락 처리됨');
            loadVerifications();
        }

        async function reject(id) {
            await fetch(`/api/verification/reject/${id}`, { method: 'PUT' });
            alert('거절 처리됨');
            loadVerifications();
        }

        async function del(id) {
            await fetch(`/api/verification/delete/${id}`, { method: 'DELETE' });
            alert('삭제 완료');
            loadVerifications();
        }

        window.onload = loadVerifications;
    </script>
</head>
<body>
<h1>신분증 인증 요청 목록</h1>
<table border="1">
    <thead>
    <tr>
        <th>이메일</th>
        <th>생년월일</th>
        <th>성별</th>
        <th>사진</th>
        <th>상태</th>
        <th>관리</th>
    </tr>
    </thead>
    <tbody id="verification-table"></tbody>
</table>

<hr>

<div id="detail"></div>
</body>
</html>
